<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Royalty Charts</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#1aa3ff" />
  <link rel="icon" href="icons/icon-192.svg" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="app" class="app">
    <header class="topbar">
      <div class="brand">
        <span class="brand-glow"></span>
        <div>
          <h1>Royalty Charts</h1>
          <p class="subtitle">Offline-first Trading Journal</p>
        </div>
      </div>
      <div class="topbar-actions">
        <button id="installBtn" class="btn btn-outline hidden">Install</button>
        <button id="backToJournals" class="btn btn-outline hidden">Journals</button>
      </div>
    </header>

    <main>
      <section id="journalSelector" class="screen active">
        <div class="card">
          <h2>Journals</h2>
          <p class="muted">Create separate journals for each account. Data stays on this device.</p>
          <div class="journal-list" id="journalList"></div>
          <div class="journal-actions">
            <input id="newJournalName" type="text" placeholder="Journal name" />
            <button id="createJournalBtn" class="btn btn-primary">Create Journal</button>
          </div>
        </div>
      </section>

      <section id="journalApp" class="screen">
        <nav class="tabs">
          <button data-tab="calendar" class="tab active">Calendar</button>
          <button data-tab="add" class="tab">Add Trade</button>
          <button data-tab="trades" class="tab">Trades</button>
          <button data-tab="analytics" class="tab">Analytics</button>
          <button data-tab="settings" class="tab">Settings</button>
        </nav>

        <section id="calendar" class="tab-panel active">
          <div class="calendar-header">
            <button id="prevMonth" class="btn btn-outline">◀</button>
            <div>
              <h2 id="calendarLabel">Month 2024</h2>
              <p class="muted">Tap a day for details</p>
            </div>
            <button id="nextMonth" class="btn btn-outline">▶</button>
          </div>
          <div class="calendar-grid" id="calendarGrid"></div>
          <div id="dayDetail" class="card hidden"></div>
        </section>

        <section id="add" class="tab-panel">
          <form id="tradeForm" class="card form">
            <h2>Add Trade</h2>
            <div class="form-grid">
              <label>
                Instrument
                <input name="instrument" type="text" placeholder="EURUSD" />
              </label>
              <label>
                Market Type
                <select name="marketType">
                  <option value="Forex">Forex</option>
                  <option value="Synthetic">Synthetic</option>
                </select>
              </label>
              <label>
                Direction
                <select name="direction">
                  <option value="Buy">Buy</option>
                  <option value="Sell">Sell</option>
                </select>
              </label>
              <label>
                Date/Time
                <input name="dateTime" type="datetime-local" />
              </label>
              <label>
                Session
                <select name="session">
                  <option value="Asia">Asia</option>
                  <option value="London">London</option>
                  <option value="New York">New York</option>
                  <option value="Custom">Custom</option>
                </select>
              </label>
              <label>
                Entry Price
                <input name="entryPrice" type="number" step="0.0001" />
              </label>
              <label>
                Stop-loss Price
                <input name="stopLoss" type="number" step="0.0001" />
              </label>
              <label>
                Take-profit Price
                <input name="takeProfit" type="number" step="0.0001" />
              </label>
              <label>
                Exit Price
                <input name="exitPrice" type="number" step="0.0001" />
              </label>
              <label>
                Lot Size
                <input name="lotSize" type="number" step="0.01" />
              </label>
              <label>
                Account Balance
                <input name="balance" type="number" step="0.01" />
              </label>
              <label>
                Risk %
                <input name="riskPercent" type="number" step="0.01" />
              </label>
              <label>
                Risk Amount (auto)
                <input name="riskAmount" type="number" step="0.01" readonly />
              </label>
              <label>
                P/L ($)
                <input name="plUsd" type="number" step="0.01" />
              </label>
              <label>
                P/L (₦)
                <input name="plNgn" type="number" step="0.01" />
              </label>
              <label>
                Pips
                <input name="pips" type="number" step="0.1" />
              </label>
              <label>
                Tags (comma separated)
                <input name="tags" type="text" placeholder="Breakout, NY open" />
              </label>
              <label>
                Status
                <select name="status">
                  <option value="Open">Open</option>
                  <option value="Closed">Closed</option>
                </select>
              </label>
              <label>
                Close Date/Time
                <input name="closeDateTime" type="datetime-local" />
              </label>
            </div>
            <label>
              Notes
              <textarea name="notes" rows="4"></textarea>
            </label>

            <div class="card subtle">
              <h3>Confluence Checklist</h3>
              <div id="confluenceChecklist" class="checklist"></div>
              <p class="muted">Score is saved with the trade.</p>
            </div>

            <div class="card subtle">
              <h3>Screenshots</h3>
              <input id="screenshotInput" type="file" accept="image/*" multiple />
              <div id="screenshotPreview" class="screenshot-grid"></div>
            </div>

            <div class="card subtle">
              <h3>Risk Guidance</h3>
              <p id="riskGuidance" class="muted">Provide balance, risk %, entry, and stop-loss to calculate risk.</p>
            </div>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Save Trade</button>
              <button type="button" id="resetTradeForm" class="btn btn-outline">Reset</button>
            </div>
          </form>
        </section>

        <section id="trades" class="tab-panel">
          <div class="card">
            <div class="trades-header">
              <h2>Trades</h2>
              <div class="trades-controls">
                <input id="tradeSearch" type="search" placeholder="Search" />
                <select id="tradeSort">
                  <option value="dateDesc">Date (newest)</option>
                  <option value="dateAsc">Date (oldest)</option>
                  <option value="plDesc">P/L (high)</option>
                  <option value="plAsc">P/L (low)</option>
                </select>
              </div>
            </div>
            <div id="tradeList" class="trade-list"></div>
          </div>
        </section>

        <section id="analytics" class="tab-panel">
          <div class="card">
            <h2>Analytics</h2>
            <div class="filters">
              <input id="filterStart" type="date" />
              <input id="filterEnd" type="date" />
              <input id="filterInstrument" type="text" placeholder="Instrument" />
              <select id="filterDirection">
                <option value="">Direction</option>
                <option value="Buy">Buy</option>
                <option value="Sell">Sell</option>
              </select>
              <select id="filterMarket">
                <option value="">Market</option>
                <option value="Forex">Forex</option>
                <option value="Synthetic">Synthetic</option>
              </select>
              <input id="filterTag" type="text" placeholder="Tag" />
              <input id="filterConfluenceMin" type="number" placeholder="Confluence min" />
              <input id="filterConfluenceMax" type="number" placeholder="Confluence max" />
              <button id="applyFilters" class="btn btn-outline">Apply</button>
            </div>
            <div class="stats-grid" id="analyticsStats"></div>
            <div class="chart-grid">
              <canvas id="equityChart" height="160"></canvas>
              <canvas id="dailyChart" height="160"></canvas>
            </div>
            <div id="confluenceStats" class="card subtle"></div>
          </div>
        </section>

        <section id="settings" class="tab-panel">
          <div class="card">
            <h2>Journal Settings</h2>
            <div class="form-grid">
              <label>
                Journal Name
                <input id="journalNameInput" type="text" />
              </label>
              <button id="renameJournal" class="btn btn-outline">Rename</button>
              <button id="deleteJournal" class="btn btn-danger">Delete Journal</button>
            </div>
            <div class="card subtle">
              <h3>Confluence Template</h3>
              <div id="templateEditor"></div>
              <div class="template-actions">
                <input id="newTemplateItem" type="text" placeholder="New checklist item" />
                <button id="addTemplateItem" class="btn btn-primary">Add Item</button>
              </div>
            </div>
            <div class="card subtle">
              <h3>Instrument Values</h3>
              <p class="muted">Add pip value per lot (Forex) or value per point (Synthetic) for sizing guidance.</p>
              <div id="instrumentValues"></div>
              <div class="template-actions">
                <input id="instrumentName" type="text" placeholder="Instrument" />
                <input id="instrumentValue" type="number" step="0.01" placeholder="Value" />
                <select id="instrumentType">
                  <option value="Forex">Forex (pip value/lot)</option>
                  <option value="Synthetic">Synthetic (value/point)</option>
                </select>
                <button id="addInstrumentValue" class="btn btn-primary">Save Value</button>
              </div>
            </div>
            <div class="card subtle">
              <h3>Import / Export</h3>
              <div class="import-export">
                <button id="exportJson" class="btn btn-outline">Export JSON</button>
                <button id="exportCsv" class="btn btn-outline">Export CSV</button>
                <input id="importJson" type="file" accept="application/json" />
              </div>
            </div>
          </div>
        </section>
      </section>
    </main>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
